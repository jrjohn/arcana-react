import{c as E,b as F,u as $,r as o,j as e,L as P}from"./index-hLLwv5Ut.js";function A(){const{id:d}=E(),N=F(),{t:s}=$(),m=!!d,[l,b]=o.useState({firstName:"",lastName:"",email:"",avatar:""}),[i,x]=o.useState({}),[p,j]=o.useState(m),[c,v]=o.useState(!1),[g,u]=o.useState(null);o.useEffect(()=>{m&&d&&(async()=>{j(!0);try{const t=(await(await fetch(`https://reqres.in/api/users/${d}`)).json()).data;b({firstName:t.first_name,lastName:t.last_name,email:t.email,avatar:t.avatar||""})}catch{u(s("error.not.found"))}finally{j(!1)}})()},[d,m,s]);const y=(r,a)=>{const n=/^[a-zA-Z\s\-']+$/;switch(r){case"firstName":if(!a.trim())return s("user.form.error.first.name.required");if(a.length<2)return s("user.form.error.first.name.min");if(a.length>50)return s("user.form.error.first.name.max");if(!n.test(a))return s("user.form.error.first.name.pattern");break;case"lastName":if(!a.trim())return s("user.form.error.last.name.required");if(a.length<2)return s("user.form.error.last.name.min");if(a.length>50)return s("user.form.error.last.name.max");if(!n.test(a))return s("user.form.error.last.name.pattern");break;case"email":if(!a.trim())return s("user.form.error.email.required");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a))return s("user.form.error.email.invalid");break;case"avatar":if(a.trim()&&!/^https?:\/\/.+/.test(a))return s("user.form.error.avatar.invalid");break}},f=r=>{const{name:a,value:n}=r.target;b(t=>({...t,[a]:n})),i[a]&&x(t=>({...t,[a]:void 0}))},h=r=>{const{name:a,value:n}=r.target,t=y(a,n);t&&x(k=>({...k,[a]:t}))},w=()=>{const r={};return Object.keys(l).forEach(a=>{const n=a,t=y(n,l[n]);t&&(r[n]=t)}),x(r),Object.keys(r).length===0},S=async r=>{if(r.preventDefault(),!!w()){v(!0),u(null);try{const a=m?`https://reqres.in/api/users/${d}`:"https://reqres.in/api/users";await fetch(a,{method:m?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({first_name:l.firstName,last_name:l.lastName,email:l.email,avatar:l.avatar})}),N("/users")}catch{u(s("error.unknown"))}finally{v(!1)}}},C=()=>{const r=l.firstName.charAt(0)||"",a=l.lastName.charAt(0)||"";return`${r}${a}`.toUpperCase()||"?"};return e.jsxs("div",{className:"user-form-page container-fluid py-4",children:[e.jsxs("button",{className:"btn btn-outline-secondary mb-3",onClick:()=>N("/users"),children:[e.jsx("i",{className:"bi bi-arrow-left me-2"}),s("common.back")]}),e.jsxs("div",{className:"page-header mb-4",children:[e.jsx("h2",{className:"mb-1",children:s(m?"user.form.edit.title":"user.form.create.title")}),e.jsx("p",{className:"text-muted mb-0",children:s(m?"user.form.edit.subtitle":"user.form.create.subtitle")})]}),g&&e.jsxs("div",{className:"alert alert-danger alert-dismissible fade show",role:"alert",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),g,e.jsx("button",{type:"button",className:"btn-close",onClick:()=>u(null)})]}),p&&e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:s("common.loading")})}),e.jsx("p",{className:"mt-3 text-muted",children:s("user.form.loading")})]}),!p&&e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-lg-8",children:e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("form",{onSubmit:S,noValidate:!0,children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"firstName",className:"form-label",children:[s("user.form.field.first.name")," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",id:"firstName",name:"firstName",className:`form-control ${i.firstName?"is-invalid":""}`,placeholder:s("user.form.placeholder.first.name"),value:l.firstName,onChange:f,onBlur:h,disabled:c}),i.firstName&&e.jsx("div",{className:"invalid-feedback",children:i.firstName})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"lastName",className:"form-label",children:[s("user.form.field.last.name")," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",id:"lastName",name:"lastName",className:`form-control ${i.lastName?"is-invalid":""}`,placeholder:s("user.form.placeholder.last.name"),value:l.lastName,onChange:f,onBlur:h,disabled:c}),i.lastName&&e.jsx("div",{className:"invalid-feedback",children:i.lastName})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"email",className:"form-label",children:[s("user.form.field.email")," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"email",id:"email",name:"email",className:`form-control ${i.email?"is-invalid":""}`,placeholder:s("user.form.placeholder.email"),value:l.email,onChange:f,onBlur:h,disabled:c}),i.email&&e.jsx("div",{className:"invalid-feedback",children:i.email})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{htmlFor:"avatar",className:"form-label",children:[s("user.form.field.avatar"),e.jsxs("span",{className:"text-muted ms-1",children:["(",s("user.form.optional"),")"]})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{type:"url",id:"avatar",name:"avatar",className:`form-control ${i.avatar?"is-invalid":""}`,placeholder:s("user.form.placeholder.avatar"),value:l.avatar,onChange:f,onBlur:h,disabled:c}),e.jsx("span",{className:"input-group-text p-0",children:l.avatar?e.jsx("img",{src:l.avatar,alt:"Avatar preview",className:"avatar-preview",onError:r=>{r.target.style.display="none"}}):e.jsx("div",{className:"avatar-preview avatar-initials",children:C()})})]}),i.avatar&&e.jsx("div",{className:"text-danger small mt-1",children:i.avatar})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx(P,{to:"/users",className:"btn btn-outline-secondary",children:s("user.form.button.cancel")}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2"}),s("user.form.button.saving")]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-check-lg me-2"}),s(m?"user.form.button.update":"user.form.button.create")]})})]})]})})})}),e.jsx("div",{className:"col-lg-4 mt-4 mt-lg-0",children:e.jsx("div",{className:"card bg-light",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h6",{className:"card-title",children:[e.jsx("i",{className:"bi bi-question-circle me-2 text-primary"}),s("user.form.help.title")]}),e.jsxs("ul",{className:"list-unstyled small text-muted mb-0",children:[e.jsxs("li",{className:"mb-2",children:[e.jsx("i",{className:"bi bi-check text-success me-2"}),s("user.form.help.name.length")]}),e.jsxs("li",{className:"mb-2",children:[e.jsx("i",{className:"bi bi-check text-success me-2"}),s("user.form.help.name.characters")]}),e.jsxs("li",{className:"mb-2",children:[e.jsx("i",{className:"bi bi-check text-success me-2"}),s("user.form.help.email.format")]}),e.jsxs("li",{children:[e.jsx("i",{className:"bi bi-check text-success me-2"}),s("user.form.help.avatar.optional")]})]})]})})})]})]})}export{A as UserFormComponent};
